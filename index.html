<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a0a2e">
<title>Dylan & Theia's Egypt Adventure</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Caveat:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="app-wrapper">

<div class="bg-layer bg-desert active" id="bg-desert"></div>
<div class="bg-layer bg-ocean" id="bg-ocean"></div>
<div class="pyramid-deco" id="pyramid-deco"></div>
<div id="bubbles-box"></div>

<!-- Parent toggle (inside wrapper so it rotates too) -->
<div class="parent-toggle-area" id="parent-toggle-area">
  <div class="parent-badge on" id="parent-badge">ğŸ‘ï¸ Parent: ON</div>
  <div class="parent-hint" id="parent-hint">Hold to toggle</div>
</div>

<!-- WELCOME -->
<div id="welcome-screen" class="screen active">
  <div class="emoji-row">ğŸª ğŸ›ï¸ ğŸ  âœ¨</div>
  <div class="app-title">Dylan & Theia's<br>Egypt Adventure</div>
  <div class="app-subtitle">Who's ready to explore? ğŸŒŸ</div>
  <div class="child-select">
    <button class="child-btn dylan" onclick="selectChild('dylan')">
      <div class="child-avatar">ğŸ¦</div><div>Dylan</div><div class="child-age">Age 4</div>
    </button>
    <button class="child-btn theia" onclick="selectChild('theia')">
      <div class="child-avatar">ğŸ¦‹</div><div>Theia</div><div class="child-age">Age 5</div>
    </button>
  </div>
  <button class="child-btn together" onclick="selectChild('together')">
    <div class="child-avatar">ğŸ¦ğŸ¦‹</div><div>Play Together!</div><div class="child-age">Joint challenges & races</div>
  </button>
  <button class="install-btn" id="install-btn" style="display:none" onclick="installApp()">ğŸ“² Install App</button>
</div>

<!-- MENU -->
<div id="menu-screen" class="screen">
  <div class="menu-header">
    <div id="menu-child-name" class="menu-child-name"></div>
    <div class="app-subtitle">Choose your adventure! ğŸ—ºï¸</div>
  </div>
  <div class="menu-grid" id="menu-grid"></div>
  <button class="back-btn" onclick="goToWelcome()" style="margin-top:8px">â† Back</button>
</div>

<!-- TASK -->
<div id="task-screen" class="screen">
  <div class="task-top-bar">
    <button class="back-btn" style="padding:6px 12px;font-size:0.8rem;" onclick="goToMenu()">â† Menu</button>
    <div class="task-progress" id="task-progress"></div>
    <div class="task-badge" id="task-badge"></div>
  </div>
  <div id="task-content" style="display:flex;flex-direction:column;align-items:center;gap:10px;width:100%;"></div>
</div>

<!-- PARENT CHECK -->
<div id="parent-screen" class="screen">
  <div class="parent-emoji">ğŸŒŸ</div>
  <div class="parent-message" id="parent-message"></div>
  <img id="parent-canvas-preview" class="parent-canvas-preview" style="display:none">
  <div class="parent-btns">
    <button class="next-btn" onclick="parentApprove()">Next Task âœ</button>
    <button class="back-btn" onclick="goToMenu()">Back to Menu</button>
  </div>
</div>

<!-- COMPLETE -->
<div id="complete-screen" class="screen">
  <div class="complete-stars">â­ğŸŒŸâ­</div>
  <div class="complete-message" id="complete-message"></div>
  <div class="parent-emoji">ğŸ‰</div>
  <div class="parent-btns">
    <button class="next-btn" onclick="goToMenu()">More Adventures! ğŸ—ºï¸</button>
    <button class="back-btn" onclick="goToWelcome()">Switch Explorer</button>
  </div>
</div>

</div><!-- /app-wrapper -->

<!-- Rotate button lives OUTSIDE wrapper so it stays in place -->
<button class="rotate-btn" id="rotate-btn" style="display:none" onclick="toggleOrientation()">â†”ï¸</button>

<script>
// PWA Install prompt
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('install-btn').style.display = '';
});
function installApp() {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then((result) => {
    deferredPrompt = null;
    document.getElementById('install-btn').style.display = 'none';
  });
}
window.addEventListener('appinstalled', () => {
  document.getElementById('install-btn').style.display = 'none';
  deferredPrompt = null;
});

// Landscape mode via CSS rotation â€” works regardless of OS/API restrictions
let fakeLandscape = false;

function toggleOrientation() {
  fakeLandscape = !fakeLandscape;
  applyOrientation();
  updateRotateBtn();
}

function applyOrientation() {
  const wrapper = document.getElementById('app-wrapper');
  if (fakeLandscape) {
    const w = window.innerWidth;
    const h = window.innerHeight;
    wrapper.style.transform = 'rotate(90deg)';
    wrapper.style.transformOrigin = 'top left';
    wrapper.style.width = h + 'px';
    wrapper.style.height = w + 'px';
    wrapper.style.position = 'fixed';
    wrapper.style.top = '0';
    wrapper.style.left = w + 'px';
    wrapper.style.overflow = 'auto';
  } else {
    wrapper.style.transform = '';
    wrapper.style.transformOrigin = '';
    wrapper.style.width = '';
    wrapper.style.height = '';
    wrapper.style.position = '';
    wrapper.style.top = '';
    wrapper.style.left = '';
    wrapper.style.overflow = '';
  }
}

function updateRotateBtn() {
  const btn = document.getElementById('rotate-btn');
  if (!btn) return;
  btn.textContent = fakeLandscape ? 'â†•ï¸' : 'â†”ï¸';
  btn.title = fakeLandscape ? 'Back to portrait' : 'Go landscape';
}

// Reapply on resize (e.g. keyboard open/close)
window.addEventListener('resize', () => {
  if (fakeLandscape) applyOrientation();
});

// Always show the button
window.addEventListener('load', () => {
  document.getElementById('rotate-btn').style.display = '';
});
</script>
<script src="app-stories.js"></script>
<script src="app-core.js"></script>
<script src="app-tasks.js"></script>
<script src="app-render.js"></script>
</body>
</html>
